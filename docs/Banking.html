<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Banking
  
    &mdash; Documentation by YARD 0.9.28
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Banking";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (B)</a> &raquo;
    
    
    <span class="title">Banking</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Banking
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Banking</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/models/banking/banking.rb</dd>
  </dl>
  
</div>








  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#client-class_method" title="client (class method)">.<strong>client</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Plaid client with all the required configurations.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_access_token-class_method" title="get_access_token (class method)">.<strong>get_access_token</strong>(public_token)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Using a Link token from the webapp, get an access token used to query the plaid API.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_accounts-class_method" title="get_accounts (class method)">.<strong>get_accounts</strong>(bank_credential)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>query the plaid api for all accounts linked (information only, you can’t change anything, it is set between the end user and plaid).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_institution-class_method" title="get_institution (class method)">.<strong>get_institution</strong>(access_token)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>query the plaid api for all accounts linked (information only, you can’t change anything, it is set between the end user and plaid).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_link_token-class_method" title="get_link_token (class method)">.<strong>get_link_token</strong>(organization_id)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get a link token for the Link web app.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_transactions-class_method" title="get_transactions (class method)">.<strong>get_transactions</strong>(bank_credential)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>query the plaid api and get all transactions between two dates.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_link_token-class_method" title="update_link_token (class method)">.<strong>update_link_token</strong>(organization_id, access_token)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="client-class_method">
  
    .<strong>client</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Plaid client with all the required configurations</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10
11
12
13
14
15
16</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/banking/banking.rb', line 8</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span>
  <span class='id identifier rubyid_configuration'>configuration</span> <span class='op'>=</span> <span class='const'>Plaid</span><span class='op'>::</span><span class='const'>Configuration</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_server_index'>server_index</span> <span class='op'>=</span> <span class='const'>Plaid</span><span class='op'>::</span><span class='const'>Configuration</span><span class='op'>::</span><span class='const'>Environment</span><span class='lbracket'>[</span><span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>PLAID_ENVIRONMENT</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_api_key'>api_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>PLAID-CLIENT-ID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>PLAID_CLIENT_ID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_api_key'>api_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>PLAID-SECRET</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>PLAID_SECRET</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_api_client'>api_client</span> <span class='op'>=</span> <span class='const'>Plaid</span><span class='op'>::</span><span class='const'>ApiClient</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_configuration'>configuration</span><span class='rparen'>)</span>
  <span class='const'>Plaid</span><span class='op'>::</span><span class='const'>PlaidApi</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_api_client'>api_client</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_access_token-class_method">
  
    .<strong>get_access_token</strong>(public_token)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Using a Link token from the webapp, get an access token used to query the plaid API.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


86
87
88
89
90
91
92</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/banking/banking.rb', line 86</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_access_token'>get_access_token</span><span class='lparen'>(</span><span class='id identifier rubyid_public_token'>public_token</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='const'>Plaid</span><span class='op'>::</span><span class='const'>ItemPublicTokenExchangeRequest</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_public_token'>public_token</span> <span class='op'>=</span> <span class='id identifier rubyid_public_token'>public_token</span>

  <span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_item_public_token_exchange'>item_public_token_exchange</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_access_token'>access_token</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_accounts-class_method">
  
    .<strong>get_accounts</strong>(bank_credential)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>query the plaid api for all accounts linked (information only, you can’t change anything, it is set between the end user and plaid)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/banking/banking.rb', line 119</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_accounts'>get_accounts</span><span class='lparen'>(</span><span class='id identifier rubyid_bank_credential'>bank_credential</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_accounts'>accounts</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='const'>Plaid</span><span class='op'>::</span><span class='const'>AuthGetRequest</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_access_token'>access_token</span> <span class='op'>=</span> <span class='id identifier rubyid_bank_credential'>bank_credential</span><span class='period'>.</span><span class='id identifier rubyid_access_token'>access_token</span>
  <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_accounts_get'>accounts_get</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_accounts'>accounts</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_accounts'>accounts</span>
  <span class='kw'>rescue</span> <span class='const'>Plaid</span><span class='op'>::</span><span class='const'>ApiError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='comment'># Update the credential status
</span>    <span class='id identifier rubyid_err'>err</span> <span class='op'>=</span> <span class='const'>JSON</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_response_body'>response_body</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>false</span>

    <span class='id identifier rubyid_bank_credential'>bank_credential</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span>
      <span class='label'>status:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='label'>error_type:</span> <span class='id identifier rubyid_err'>err</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error_type</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='label'>error_code:</span> <span class='id identifier rubyid_err'>err</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error_code</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='lbracket'>[</span><span class='id identifier rubyid_accounts'>accounts</span><span class='comma'>,</span> <span class='id identifier rubyid_success'>success</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_institution-class_method">
  
    .<strong>get_institution</strong>(access_token)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>query the plaid api for all accounts linked (information only, you can’t change anything, it is set between the end user and plaid)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/banking/banking.rb', line 96</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_institution'>get_institution</span><span class='lparen'>(</span><span class='id identifier rubyid_access_token'>access_token</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='const'>Plaid</span><span class='op'>::</span><span class='const'>AuthGetRequest</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_access_token'>access_token</span> <span class='op'>=</span> <span class='id identifier rubyid_access_token'>access_token</span>

  <span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_accounts_get'>accounts_get</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_institution_id'>institution_id</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_institution_id'>institution_id</span>

  <span class='id identifier rubyid_request2'>request2</span> <span class='op'>=</span> <span class='const'>Plaid</span><span class='op'>::</span><span class='const'>InstitutionsGetByIdRequest</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
    <span class='lbrace'>{</span>
      <span class='label'>institution_id:</span><span class='comma'>,</span>
      <span class='label'>country_codes:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CA</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='label'>options:</span> <span class='lbrace'>{</span>
        <span class='label'>include_optional_metadata:</span> <span class='kw'>true</span>
      <span class='rbrace'>}</span>
    <span class='rbrace'>}</span>
  <span class='rparen'>)</span>

  <span class='id identifier rubyid_response2'>response2</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_institutions_get_by_id'>institutions_get_by_id</span><span class='lparen'>(</span><span class='id identifier rubyid_request2'>request2</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_response2'>response2</span><span class='period'>.</span><span class='id identifier rubyid_institution'>institution</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_link_token-class_method">
  
    .<strong>get_link_token</strong>(organization_id)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get a link token for the Link web app</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/banking/banking.rb', line 19</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_link_token'>get_link_token</span><span class='lparen'>(</span><span class='id identifier rubyid_organization_id'>organization_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_link_token_create_request'>link_token_create_request</span> <span class='op'>=</span> <span class='const'>Plaid</span><span class='op'>::</span><span class='const'>LinkTokenCreateRequest</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='lbrace'>{</span>
                                                                  <span class='label'>user:</span> <span class='lbrace'>{</span>
                                                                    <span class='label'>client_user_id:</span> <span class='id identifier rubyid_organization_id'>organization_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
                                                                  <span class='rbrace'>}</span><span class='comma'>,</span>
                                                                  <span class='label'>client_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Influence Accounting</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
                                                                  <span class='label'>products:</span> <span class='qwords_beg'>%w[</span><span class='tstring_content'>transactions</span><span class='tstring_end'>]</span></span><span class='comma'>,</span>
                                                                  <span class='label'>country_codes:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CA</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
                                                                  <span class='label'>language:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>en</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
                                                                  <span class='label'>webhook:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>https://ninetyfour-plaid.ultrahook.com/webhooks/plaid</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
                                                                  <span class='label'>account_filters:</span> <span class='lbrace'>{</span>
                                                                    <span class='label'>depository:</span> <span class='lbrace'>{</span>
                                                                      <span class='label'>account_subtypes:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>all</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
                                                                    <span class='rbrace'>}</span><span class='comma'>,</span>
                                                                    <span class='label'>credit:</span> <span class='lbrace'>{</span>
                                                                      <span class='label'>account_subtypes:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>all</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
                                                                    <span class='rbrace'>}</span><span class='comma'>,</span>
                                                                    <span class='label'>loan:</span> <span class='lbrace'>{</span>
                                                                      <span class='label'>account_subtypes:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>all</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
                                                                    <span class='rbrace'>}</span>
                                                                  <span class='rbrace'>}</span>
                                                                <span class='rbrace'>}</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_link_token_response'>link_token_response</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_link_token_create'>link_token_create</span><span class='lparen'>(</span>
    <span class='id identifier rubyid_link_token_create_request'>link_token_create_request</span>
  <span class='rparen'>)</span>

  <span class='id identifier rubyid_link_token_response'>link_token_response</span><span class='period'>.</span><span class='id identifier rubyid_link_token'>link_token</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_transactions-class_method">
  
    .<strong>get_transactions</strong>(bank_credential)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>query the plaid api and get all transactions between two dates.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/banking/banking.rb', line 145</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_transactions'>get_transactions</span><span class='lparen'>(</span><span class='id identifier rubyid_bank_credential'>bank_credential</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cursor'>cursor</span> <span class='op'>=</span> <span class='id identifier rubyid_bank_credential'>bank_credential</span><span class='period'>.</span><span class='id identifier rubyid_latest_cursor'>latest_cursor</span>

  <span class='id identifier rubyid_added'>added</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_modified'>modified</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_removed'>removed</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='comment'># Removed transaction ids
</span>  <span class='id identifier rubyid_has_more'>has_more</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='kw'>begin</span>
    <span class='comment'># Iterate through each page of new transaction updates for item
</span>    <span class='kw'>while</span> <span class='id identifier rubyid_has_more'>has_more</span>
      <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='const'>Plaid</span><span class='op'>::</span><span class='const'>TransactionsSyncRequest</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
        <span class='lbrace'>{</span>
          <span class='label'>access_token:</span> <span class='id identifier rubyid_bank_credential'>bank_credential</span><span class='period'>.</span><span class='id identifier rubyid_access_token'>access_token</span><span class='comma'>,</span>
          <span class='label'>cursor:</span>
        <span class='rbrace'>}</span>
      <span class='rparen'>)</span>
      <span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_transactions_sync'>transactions_sync</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>

      <span class='comment'># Add this page of results
</span>      <span class='id identifier rubyid_added'>added</span> <span class='op'>+=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_added'>added</span>
      <span class='id identifier rubyid_modified'>modified</span> <span class='op'>+=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_modified'>modified</span>
      <span class='id identifier rubyid_removed'>removed</span> <span class='op'>+=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_removed'>removed</span>
      <span class='id identifier rubyid_has_more'>has_more</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_has_more'>has_more</span>

      <span class='comment'># Update cursor to the next cursor
</span>      <span class='id identifier rubyid_cursor'>cursor</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_next_cursor'>next_cursor</span>
    <span class='kw'>end</span>
  <span class='kw'>rescue</span> <span class='const'>Plaid</span><span class='op'>::</span><span class='const'>ApiError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='comment'># Update the credential status
</span>    <span class='id identifier rubyid_err'>err</span> <span class='op'>=</span> <span class='const'>JSON</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_response_body'>response_body</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>false</span>

    <span class='id identifier rubyid_bank_credential'>bank_credential</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span>
      <span class='label'>status:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='label'>error_type:</span> <span class='id identifier rubyid_err'>err</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error_type</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='label'>error_code:</span> <span class='id identifier rubyid_err'>err</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error_code</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='lbracket'>[</span><span class='id identifier rubyid_added'>added</span><span class='comma'>,</span> <span class='id identifier rubyid_modified'>modified</span><span class='comma'>,</span> <span class='id identifier rubyid_removed'>removed</span><span class='comma'>,</span> <span class='id identifier rubyid_cursor'>cursor</span><span class='comma'>,</span> <span class='id identifier rubyid_success'>success</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_link_token-class_method">
  
    .<strong>update_link_token</strong>(organization_id, access_token)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/banking/banking.rb', line 49</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_update_link_token'>update_link_token</span><span class='lparen'>(</span><span class='id identifier rubyid_organization_id'>organization_id</span><span class='comma'>,</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_link_token_create_request'>link_token_create_request</span> <span class='op'>=</span> <span class='const'>Plaid</span><span class='op'>::</span><span class='const'>LinkTokenCreateRequest</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='lbrace'>{</span>
                                                                  <span class='label'>user:</span> <span class='lbrace'>{</span>
                                                                    <span class='label'>client_user_id:</span> <span class='id identifier rubyid_organization_id'>organization_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
                                                                  <span class='rbrace'>}</span><span class='comma'>,</span>
                                                                  <span class='label'>client_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Influence Accounting</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
                                                                  <span class='label'>products:</span> <span class='qwords_beg'>%w[</span><span class='tstring_content'>transactions</span><span class='tstring_end'>]</span></span><span class='comma'>,</span>
                                                                  <span class='label'>country_codes:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CA</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
                                                                  <span class='label'>language:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>en</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
                                                                  <span class='label'>webhook:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>https://ninetyfour-plaid.ultrahook.com/webhooks/plaid</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
                                                                  <span class='label'>account_filters:</span> <span class='lbrace'>{</span>
                                                                    <span class='label'>depository:</span> <span class='lbrace'>{</span>
                                                                      <span class='label'>account_subtypes:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>all</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
                                                                    <span class='rbrace'>}</span><span class='comma'>,</span>
                                                                    <span class='label'>credit:</span> <span class='lbrace'>{</span>
                                                                      <span class='label'>account_subtypes:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>all</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
                                                                    <span class='rbrace'>}</span><span class='comma'>,</span>
                                                                    <span class='label'>loan:</span> <span class='lbrace'>{</span>
                                                                      <span class='label'>account_subtypes:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>all</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
                                                                    <span class='rbrace'>}</span>
                                                                  <span class='rbrace'>}</span><span class='comma'>,</span>
                                                                  <span class='label'>link_customization_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>account_selection_v2_custom</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
                                                                  <span class='label'>update:</span> <span class='lbrace'>{</span>
                                                                    <span class='label'>account_selection_enabled:</span> <span class='kw'>true</span>
                                                                  <span class='rbrace'>}</span><span class='comma'>,</span>
                                                                  <span class='label'>access_token:</span>
                                                                <span class='rbrace'>}</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_link_token_response'>link_token_response</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_link_token_create'>link_token_create</span><span class='lparen'>(</span>
    <span class='id identifier rubyid_link_token_create_request'>link_token_create_request</span>
  <span class='rparen'>)</span>

  <span class='id identifier rubyid_link_token_response'>link_token_response</span><span class='period'>.</span><span class='id identifier rubyid_link_token'>link_token</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Thu Feb  2 17:09:03 2023 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.28 (ruby-3.1.2).
</div>

    </div>
  </body>
</html>